# 소설 목록 표시 문제 해결 가이드

## 문제 상황
Supabase에 존재하는 novel 항목이 화면에 표시되지 않음

## 가능한 원인 및 해결 방법

### 1. 요일별 연재 (`/api/novel/serial-day/[day]`)

**문제 가능성:**
- DB의 `serialDay` 값이 프론트엔드에서 요청하는 값과 다를 수 있음
- 프론트엔드: `monday`, `tuesday` 등 (영어)
- DB에 저장된 값: 한글("월", "화") 또는 다른 형식일 수 있음

**확인 방법:**
```sql
-- Supabase SQL Editor에서 실행
SELECT id, title, "serialDay" FROM novel LIMIT 10;
```

**해결:**
- DB의 `serialDay` 값이 영어 형식(`monday`, `tuesday` 등)이어야 함
- 한글이면 마이그레이션 필요:
  ```sql
  UPDATE novel SET "serialDay" = 'monday' WHERE "serialDay" = '월';
  UPDATE novel SET "serialDay" = 'tuesday' WHERE "serialDay" = '화';
  -- ... 나머지 요일도 동일하게
  ```

### 2. Top 10 (`/api/novel/top10`)

**문제 가능성:**
- `getAllNovels()`가 빈 배열 반환
- 소설의 연관 데이터(유저, 장르, 좋아요 등) 조회 실패로 필터링됨

**확인 방법:**
- 브라우저 콘솔에서 `/api/novel/top10` 응답 확인
- 서버 로그에서 "Top 10 소설 조회 오류" 메시지 확인

**해결:**
- 방어 코드 추가 완료 (오류 시 빈 배열 반환)
- DB에 소설이 있는지 확인:
  ```sql
  SELECT COUNT(*) FROM novel;
  ```

### 3. 내가 쓴 글 (`/api/user/novel`)

**문제 가능성:**
- 로그인하지 않은 상태
- 해당 사용자의 소설이 없음
- `userId`가 일치하지 않음

**확인 방법:**
- 브라우저 콘솔에서 `/api/user/novel` 응답 확인
- 로그인 상태 확인

### 4. 공통 문제

**DB 연결 문제:**
- `.env.local`의 `DATABASE_URL`이 올바른지 확인
- Supabase 연결 상태 확인

**스키마 불일치:**
- Prisma 스키마와 실제 DB 스키마가 다를 수 있음
- `npx prisma db pull`로 현재 DB 스키마 확인

## 적용된 방어 코드

1. **리포지토리 레벨**
   - `getNovelsBySerialDay`: try/catch 추가, 오류 시 빈 배열 반환
   - `getAllNovels`: try/catch 추가, 오류 시 빈 배열 반환

2. **Usecase 레벨**
   - `DfNovelsBySerialDayUsecase`: 유저 정보 없을 때 null 반환 후 필터링
   - `DfTopNovelsUsecase`: 각 소설 처리 시 오류 발생해도 계속 진행

3. **API 레벨**
   - `/api/novel/serial-day/[day]`: 오류 시 빈 배열 반환 (500 대신 200)
   - `/api/novel/top10`: 오류 시 빈 배열 반환 (500 대신 200)

4. **프론트엔드 레벨**
   - `SerialDayBook`: `data.novels`가 배열이 아니면 빈 배열로 설정
   - `Top10`: 응답이 배열이 아니면 빈 배열로 처리

## 디버깅 체크리스트

- [ ] Supabase에서 `SELECT * FROM novel;` 실행하여 데이터 존재 확인
- [ ] 각 소설의 `serialDay` 값 확인 (영어 형식인지)
- [ ] 브라우저 개발자 도구에서 네트워크 탭 확인
- [ ] 서버 콘솔 로그 확인 (오류 메시지)
- [ ] 로그인 상태 확인 (내가 쓴 글의 경우)
